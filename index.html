<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Gemini Lyric Forge V5.0</title>
    <link rel="stylesheet" href="style.css">
    <!-- Optional: html2canvas for image export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>‚ôä The Gemini Lyric Forge</h1>
        <p class="app-subtitle">V5.0 - Synthesis Mastery Engine</p>
        
        <!-- ============================================
             DASHBOARD VIEW
             ============================================ -->
        <div id="dashboard-view" class="view active">
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">F-Score Avg</div>
                    <div class="stat-value" id="avg-f-score">0%</div>
                </div>
                <div class="stat-card ocean">
                    <div class="stat-label">P-Score Avg</div>
                    <div class="stat-value" id="avg-p-score">0%</div>
                </div>
            </div>
            
            <!-- Challenge Selection -->
            <div class="card card-accent">
                <h2>üéØ Daily Challenges</h2>
                <p class="text-muted">Choose your training focus for today:</p>
                
                <button class="drake-btn" onclick="startChallenge('drake_structure')">
                    üé§ Melodic Flow Drill (F-Score)
                </button>
                
                <button class="ocean-btn" onclick="startChallenge('ocean_poetics')">
                    üåä Poetic Depth Workout (P-Score)
                </button>
            </div>
            
            <!-- Quick Reference Card -->
            <div class="card">
                <h2>üìö Quick Reference</h2>
                <p class="text-muted">Stricter scoring thresholds (V5.0):</p>
                <ul style="font-size: 0.875rem; color: var(--color-text-secondary); line-height: 1.8;">
                    <li><strong>F-Score:</strong> 5-7 syl/line, 28 lines, 3+ anchor words</li>
                    <li><strong>P-Score:</strong> 0-1 abstracts max, 5+ concrete nouns, 5+ motif words</li>
                    <li><strong>Synthesis:</strong> (F √ó P) = 85%+ for mastery</li>
                </ul>
            </div>
        </div>

        <!-- ============================================
             CHALLENGE VIEW (WRITING INTERFACE)
             ============================================ -->
        <div id="challenge-view" class="view">
            <div class="card">
                <h2 id="challenge-title"></h2>
                <p id="challenge-prompt" style="color: var(--color-text-secondary);"></p>
                
                <button class="info-toggle" onclick="toggleInfo()">‚ÑπÔ∏è Strategy Guide</button>
                <div id="info-section" class="info-panel">
                    <h4>Synthesis Strategy</h4>
                    <ul>
                        <li><strong>Flow:</strong> Target 5-7 syllables per line for melodic accessibility</li>
                        <li><strong>Structure:</strong> 28 lines (8/12/8) for commercial hook frequency</li>
                        <li><strong>Lexicon:</strong> Use 3+ Drake anchor words (time, team, top, real)</li>
                        <li><strong>Imagery:</strong> Replace abstractions with concrete sensory details</li>
                        <li><strong>Motif:</strong> Sustain your chosen motif with 5+ related words</li>
                    </ul>
                </div>
            </div>
            
            <!-- Live Metrics Panel (Sticky) -->
            <div class="live-metrics">
                <h3>üìä Live Analysis</h3>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">Lines</div>
                        <div class="metric-value status-progress" id="line-count">0</div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="line-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Flow</div>
                        <div class="metric-value status-progress" id="syl-count">0.0</div>
                        <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 2px;" id="flow-type">--</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Anchors</div>
                        <div class="metric-value status-progress" id="drake-count">0</div>
                        <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 2px;">need 3+</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Abstracts</div>
                        <div class="metric-value status-progress" id="abstract-count">0</div>
                        <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 2px;">max 1</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Concrete</div>
                        <div class="metric-value status-progress" id="concrete-count">0</div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="concrete-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Motif</div>
                        <div class="metric-value status-progress" id="motif-count">0</div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="motif-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contextual Warnings -->
            <div id="contextual-warnings">
                <!-- Warnings populate here dynamically -->
            </div>
            
            <!-- Metadata Inputs -->
            <div class="metadata-inputs">
                <select id="input-mood">
                    <option value="" disabled selected>Goal Mood</option>
                    <option value="NEGATIVE">Sad/Melancholy/Conflict</option>
                    <option value="POSITIVE">Ambitious/Confident</option>
                    <option value="NEGATIVE">Nostalgic/Regretful</option>
                </select>
                <select id="input-motif">
                    <option value="" disabled selected>Core Motif</option>
                    <option value="CAR">üöó Car (Journey/Speed)</option>
                    <option value="COLOR">üé® Color (Vivid Palette)</option>
                    <option value="TIME">‚è∞ Time (Memory/Aging)</option>
                    <option value="WATER">üåä Water (Flow/Depth)</option>
                </select>
            </div>
            
            <!-- Word Bank Buttons -->
            <div class="help-buttons">
                <button class="help-btn" onclick="showMotifWords()">üìò Motif Words</button>
                <button class="help-btn" onclick="showConcreteWords()">üé® Concrete List</button>
                <button class="help-btn" onclick="showAbstractWords()">üö´ Avoid These</button>
                <button class="help-btn" onclick="showDrakeWords()">üéØ Drake Anchors</button>
            </div>
            
            <!-- Writing Area -->
            <div class="writing-container">
                <div id="highlight-overlay"></div>
                <textarea 
                    id="lyric-input" 
                    placeholder="Start writing your lyric here... (The tool will highlight abstracts in red, concrete nouns in green, and motif words in blue as you type)"
                    spellcheck="false"
                ></textarea>
            </div>
            
            <button id="submit-btn" onclick="submitLyric()">‚ú® Analyze & Score</button>
            <button class="secondary" onclick="showView('dashboard-view')">‚Üê Back to Dashboard</button>
        </div>

        <!-- ============================================
             RESULTS VIEW (SCORE REPORT)
             ============================================ -->
        <div id="results-view" class="view">
            <div class="card card-success">
                <h2>üìä Session Report Card</h2>
                
                <!-- Score Display -->
                <div class="score-grid">
                    <div class="score-card-item">
                        <div class="score-label-big">F-Score</div>
                        <div class="score-value-big" id="f-score">0</div>
                        <div class="score-subtitle">Commercial Viability</div>
                    </div>
                    <div class="score-card-item p-score">
                        <div class="score-label-big">P-Score</div>
                        <div class="score-value-big" id="p-score">0</div>
                        <div class="score-subtitle">Narrative Depth</div>
                    </div>
                    <div class="score-card-item synthesis">
                        <div class="score-label-big">Synthesis Score</div>
                        <div class="score-value-big"><span id="synthesis-score">0</span>%</div>
                        <div class="score-subtitle">F √ó P Mastery</div>
                    </div>
                </div>
                
                <!-- Feedback -->
                <h3 style="margin-top: var(--space-xl);">üí¨ Prescriptive Feedback</h3>
                <ul id="feedback-list"></ul>
                
                <!-- Analyzed Lyric with Issues Highlighted -->
                <div style="margin-top: var(--space-xl);">
                    <h3>üìù Your Lyric (Issues Highlighted)</h3>
                    <div id="analyzed-lyric" style="
                        background-color: var(--color-bg);
                        padding: var(--space-lg);
                        border-radius: var(--radius-lg);
                        border: 2px solid var(--color-border);
                        font-family: var(--font-sans);
                        line-height: 1.8;
                        white-space: pre-wrap;
                        word-wrap: break-word;
                        font-size: 0.95rem;
                    "></div>
                    <div style="margin-top: var(--space-sm); font-size: 0.875rem; color: var(--color-text-muted);">
                        <strong>Legend:</strong>
                        <span style="background-color: rgba(239, 68, 68, 0.2); padding: 2px 6px; border-radius: 4px; margin: 0 4px;">üî¥ Abstract nouns</span>
                        <span style="background-color: rgba(16, 185, 129, 0.2); padding: 2px 6px; border-radius: 4px; margin: 0 4px;">üü¢ Concrete nouns</span>
                        <span style="background-color: rgba(59, 130, 246, 0.2); padding: 2px 6px; border-radius: 4px; margin: 0 4px;">üîµ Motif words</span>
                        <span style="background-color: rgba(245, 158, 11, 0.2); padding: 2px 6px; border-radius: 4px; margin: 0 4px;">üü° Drake anchors</span>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="margin-top: var(--space-xl);">
                    <button onclick="saveAndShare()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                        üì∏ Export as Image (Camera Roll)
                    </button>
                    <div id="ios-help" style="display: none; background-color: var(--color-info-light); padding: var(--space-sm); border-radius: var(--radius-md); font-size: 0.875rem; color: #1e40af; margin: var(--space-sm) 0;">
                        <strong>üì± iOS Tip:</strong> After clicking, choose "Save Image" in the share sheet to add to camera roll, or long-press the image and select "Add to Photos".
                    </div>
                    <button onclick="exportAsText()" style="background-color: var(--color-text-secondary);">
                        üìÑ Export as Text File
                    </button>
                    <button class="secondary" onclick="showView('dashboard-view')">üîÑ New Challenge</button>
                </div>
            </div>
            
            <!-- Hidden export card for image generation -->
            <div id="export-card" style="display: none;">
                <h2 style="color: white; margin-bottom: var(--space-md);">‚ôä THE GEMINI FORGE</h2>
                <div class="score-grid">
                    <div style="text-align: center;">
                        <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 4px;">F-SCORE</div>
                        <div style="font-size: 3rem; font-weight: 800;" id="export-f-score">0</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 4px;">P-SCORE</div>
                        <div style="font-size: 3rem; font-weight: 800;" id="export-p-score">0</div>
                    </div>
                </div>
                <div style="margin-top: var(--space-lg); font-size: 1.25rem;">
                    Synthesis: <strong id="export-synthesis">0</strong>%
                </div>
                <div style="margin-top: var(--space-md); font-size: 0.875rem; opacity: 0.9;" id="export-date"></div>
                <div style="margin-top: var(--space-sm); font-size: 0.75rem; opacity: 0.8;">Semantic Intelligence Engine</div>
            </div>
        </div>
    </div>
    
    <!-- ============================================
         WORD LIST OVERLAY PANEL
         ============================================ -->
    <div id="word-list-panel">
        <div id="word-list-content">
            <!-- Content populated by JS -->
        </div>
        <button class="secondary close-panel-btn" onclick="toggleWordList()">‚úï Close</button>
    </div>
    
    <!-- Scripts -->
    <script src="lexicon.js"></script>
    <script src="lyric-forge.js"></script>
</body>
</html>
